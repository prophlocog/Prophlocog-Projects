
// Funkcja wywoływana po najechaniu kursorem na link "SYSTEM PE-X"
// Flaga do kontrolowania animacji
let isMenuAnimating = false;

document.addEventListener('DOMContentLoaded', (event) => {
    // Pobieramy wszystkie kategorie
    const categories = document.querySelectorAll('.category');

    // Iterujemy przez każdą kategorię
    categories.forEach(category => {
        // Ustawiamy zdarzenie na najechanie kursorem na kategorię
        category.addEventListener('mouseenter', () => {
            if (!isMenuAnimating) {
                isMenuAnimating = true; // Ustaw flagę animacji na true
                category.classList.add('active'); // Dodajemy klasę aktywnej kategorii
                requestAnimationFrame(() => {
                    isMenuAnimating = false; // Zresetuj flagę po następnym cyklu animacji
                });
            }
        });

        // Ustawiamy zdarzenie na zjechanie kursorem z kategorii
        category.addEventListener('mouseleave', () => {
            if (!isMenuAnimating && !category.classList.contains('clicked')) {
                setTimeout(() => {
                    category.classList.remove('active'); // Usuwamy klasę aktywnej kategorii po krótkim opóźnieniu
                }, 700); // Opóźnienie w milisekundach (tutaj 700ms)
            }
        });

        // Dodajemy zdarzenie kliknięcia na kategorię
    // Dodajemy zdarzenie kliknięcia na kategorię
category.addEventListener('click', (event) => {
    event.stopPropagation(); // Zapobiegaj propagacji, aby kliknięcia w podkategorie nie zamykały kategorii
    
    if (category.classList.contains('clicked')) {
        category.classList.remove('clicked');
        category.classList.remove('active');
        category.classList.remove('pulsate'); // Usuwamy klasę pulsacji
        removeCategoryImage(category); // Usuń obrazek z kategorii
    } else {
        // Zamknij wszystkie inne kategorie i usuń ich obrazki
        categories.forEach(otherCategory => {
            if (otherCategory !== category) {
                otherCategory.classList.remove('clicked');
                otherCategory.classList.remove('active');
                otherCategory.classList.remove('pulsate'); // Usuwamy klasę pulsowania z innych kategorii
                removeCategoryImage(otherCategory); // Usuń obrazek z innych kategorii
            }
        });
        category.classList.add('clicked');
        category.classList.add('active');
        category.classList.add('pulsate'); // Dodajemy klasę pulsowania
        addCategoryImage(category); // Dodaj obrazek do klikniętej kategorii
    }
});
    });

    // Obsługa kliknięcia w podkategorię
const subcategories = document.querySelectorAll('.submenu li');

subcategories.forEach(subcategory => {
    subcategory.addEventListener('click', (event) => {
        event.stopPropagation(); // Zatrzymaj propagację kliknięcia

        // Dodaj klasę pulsującą
        subcategory.classList.add('pulsing');

        // Usuń klasę pulsującą po 2 sekundach
        setTimeout(() => {
            subcategory.classList.remove('pulsing');
        }, 2000);
    });
});
    // Inicjuj obrazki przy starcie
    initializeImageContainers();

    // Sprawdź stan trybu ciemnego przy załadowaniu strony
    window.onload = function() {
        if (localStorage.getItem("darkMode") === "enabled") {
            document.body.classList.add("dark-mode");
            document.getElementById("darkModeToggle").checked = true;
        }
    }
});

// Funkcja zmiany trybu ciemnego
function toggleDarkMode() {
    var body = document.body;
    body.classList.toggle("dark-mode");
    // Zapamiętaj stan trybu ciemnego w localStorage
    if (body.classList.contains("dark-mode")) {
        localStorage.setItem("darkMode", "enabled");
    } else {
        localStorage.setItem("darkMode", "disabled");
    }
}

// Funkcje obsługi obrazków
var zIndexCounter = 1;

let animationTimeout;

function expandImageContainer(imageContainerDiv) {
    // Anuluj poprzednią animację, jeśli istnieje
    clearTimeout(animationTimeout);

    // Ustawiamy transformację i płynną animację
    imageContainerDiv.style.transform = 'scale(1.1)'; // Powiększenie do 110%
    imageContainerDiv.style.transition = 'transform 0.5s cubic-bezier(0.42, 0, 0.58, 1)'; // Dodaj płynną animację
    imageContainerDiv.style.zIndex = zIndexCounter++; // Ustaw z-index i zwiększ licznik

    // Usuń poprzednie nowe opisy, jeśli istnieją
    var previousNewDescriptionDiv = imageContainerDiv.querySelector('.new-description');
    if (previousNewDescriptionDiv) {
        imageContainerDiv.removeChild(previousNewDescriptionDiv);
    }

    // Utwórz nowy opis tekstu
    var newDescriptionDiv = document.createElement("div");
    newDescriptionDiv.textContent = "Kliknij aby powiększyć"; // Nowy opis tekstu
    newDescriptionDiv.classList.add("new-description"); // Dodaj klasę dla nowego opisu
    imageContainerDiv.appendChild(newDescriptionDiv); // Dodaj nowy opis do kontenera obrazka
}

function resetImageContainer(imageContainerDiv) {
    // Usuń transformację po opuszczeniu i zresetuj z-index
    setTimeout(function() {
        imageContainerDiv.style.transform = ''; // Usuń transformację po opuszczeniu
        imageContainerDiv.style.zIndex = '0'; // Zresetuj z-index
    }, 500); // Dodajemy opóźnienie 500ms

    // Usuń nowy opis, jeśli istnieje
    var newDescriptionDiv = imageContainerDiv.querySelector('.new-description');
    if (newDescriptionDiv) {
        imageContainerDiv.removeChild(newDescriptionDiv); // Usuń nowy opis, jeśli istnieje
    }
}

function removeImageContainer() {
    const imageContainer = document.querySelector('.zdjeciepoza');
    if (imageContainer) {
        imageContainer.remove();
    }
}
function initializeImageContainers() {
    var imageContainers = document.querySelectorAll('.image-container');

    imageContainers.forEach(function(imageContainerDiv) {
        // Sprawdź, czy już nie przypisano zdarzeń, aby uniknąć podwójnego przypisania
        if (!imageContainerDiv.dataset.eventsAssigned) {
            imageContainerDiv.dataset.eventsAssigned = true; // Oznacz kontener obrazka jako przypisany

            imageContainerDiv.addEventListener('mouseenter', function() {
                expandImageContainer(imageContainerDiv); // Rozwiń obrazek po najechaniu
            });

            imageContainerDiv.addEventListener('mouseleave', function() {
                resetImageContainer(imageContainerDiv); // Zresetuj obrazek po opuszczeniu
            });
        }
    });
}

function showCategoryInfo(category, animationText, additionalTextHTML, imageInfoArray) {
    console.log("Showing info for category: ", category);
    var categoryInfoDiv = document.getElementById("category-info");
    categoryInfoDiv.style.display = "flex"; // Ustaw na flexbox
    categoryInfoDiv.style.flexWrap = "wrap"; // Ustaw wrap dla elementów
    
    // Usuń istniejące dzieci z categoryInfoDiv
    while (categoryInfoDiv.firstChild) {
        categoryInfoDiv.removeChild(categoryInfoDiv.firstChild);
    }

    // Dodaj div z tekstem animacji
    var animatedTextDiv = document.createElement("div");
    animatedTextDiv.classList.add("instalacje");
    animatedTextDiv.classList.add("tekstanimowany"); 
    animatedTextDiv.textContent = animationText;
    categoryInfoDiv.appendChild(animatedTextDiv);

    // Dodaj dodatkowy tekst HTML
    var additionalTextDiv = document.createElement("div");
    additionalTextDiv.classList.add("additional-text");
    additionalTextDiv.innerHTML = additionalTextHTML;
    categoryInfoDiv.appendChild(additionalTextDiv);

    // Dodaj obrazy
    imageInfoArray.forEach(function(imageInfo) {
        // Dodaj div dla obrazka
        var imageContainerDiv = document.createElement("div");
        imageContainerDiv.classList.add("image-container");

        var imageLink = document.createElement("a"); // Utwórz element <a>
        imageLink.href = imageInfo.url || '#'; // Ustaw href na url lub '#' jeśli url nie ma

        var imageDiv = document.createElement("img");
        imageDiv.src = imageInfo.src;
        imageDiv.alt = imageInfo.alt; // Ustaw alt dla obrazu
        imageLink.appendChild(imageDiv); // Dodaj obrazek do linku
        imageContainerDiv.appendChild(imageLink); // Dodaj link do kontenera obrazka

        if (imageInfo.description) {
            var descriptionDiv = document.createElement("div");
            descriptionDiv.textContent = imageInfo.description;
            descriptionDiv.classList.add("image-description");
            imageContainerDiv.appendChild(descriptionDiv);
        }

        // Dodaj dodatkowy opis obrazka
        if (imageInfo.additionalDescription) {
            var additionalDescriptionDiv = document.createElement("div");
            additionalDescriptionDiv.textContent = imageInfo.additionalDescription;
            additionalDescriptionDiv.classList.add("image-additional-description");
            imageContainerDiv.appendChild(additionalDescriptionDiv);
        }

        // Dodaj link do całego kontenera obrazka
        if (imageInfo.url) {
            imageContainerDiv.addEventListener('click', () => {
                window.location.href = imageInfo.url;
            });
        }

        categoryInfoDiv.appendChild(imageContainerDiv);
    });

    // Zainicjuj ponownie zdarzenia dla nowych kontenerów obrazków
    initializeImageContainers();
}



// Funkcja do obsługi kliknięcia na kategorię
let isAnimating = false; // Flaga do śledzenia animacji
let activeCategory = null; // Przechowuje referencję do aktywnej kategorii

function handleCategoryClick(category) {
    if (!isAnimating) {
        isAnimating = true; // Ustawiamy flagę animacji na true

        const container = document.getElementById('category-image-container');
        const activeImage = container.querySelector('.category-image');

        if (activeCategory === category) {
            // Usuwamy obrazek i resetujemy aktywną kategorię
            removeCategoryImage(container);
            activeCategory.classList.remove('active-category');
            activeCategory = null;
            isAnimating = false; // Resetujemy flagę animacji
        } else {
            // Sprawdzamy, czy istnieje aktywny obrazek
            if (activeImage) {
                // Usuwamy obrazek z poprzedniej kategorii
                removeCategoryImage(container);
                activeCategory.classList.remove('active-category');
            }

            // Dodajemy obrazek do nowej kategorii
            addCategoryImageOutside(container);
            category.classList.add('active-category');
            activeCategory = category;

            // Resetujemy flagę animacji po zakończeniu działania
            setTimeout(() => {
                isAnimating = false;
            }, 500); // Czas trwania animacji w milisekundach
        }
    }
}

// Inicjujemy zdarzenia dla kategorii
const categories = document.querySelectorAll('.category');
categories.forEach(category => {
    category.addEventListener('click', () => {
        handleCategoryClick(category);
    });
});


// Funkcja do dodawania obrazka do kategorii
function addCategoryImage(activeCategory) {
    // Sprawdź, czy aktywna kategoria istnieje i czy obrazek nie został już dodany
    if (activeCategory && !activeCategory.querySelector('.category-image')) {
        const img = document.createElement('img');
        img.src = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj0ZXh0PjwvZz48L3N2Zz4='; // Twój kod base64
        img.alt = 'Opis obrazka';
        img.classList.add('category-specific-image'); // Nowa unikalna klasa

        // Dodaj obrazek wewnątrz aktywnej kategorii
        activeCategory.appendChild(img);
    }
}







// Funkcja do usuwania obrazka z kategorii
function removeCategoryImage(category) {
    const img = category.querySelector('.category-image, .category-specific-image');
    if (img) {
        category.removeChild(img);
    }
}

// Funkcja do przełączania obrazka na zewnątrz
function toggleImageOutside(category, imagePath, altText, additionalText) {
    console.log("Kategoria kliknięta:", category); // Dodaj tę linię

    const existingImageDiv = document.querySelector('.zdjeciepoza');
    
    if (existingImageDiv) {
        // Usuń istniejący div z obrazkiem
        existingImageDiv.remove();
    } else {
        // Utwórz nowy div z obrazkiem
        const imageDiv = document.createElement('div');
        imageDiv.classList.add('zdjeciepoza');

        const img = document.createElement('img');
        img.src = imagePath;
        img.alt = altText;

        imageDiv.appendChild(img); // Dodaj obrazek do diva

        // Dodaj tekst dodatkowy obok obrazka, jeśli istnieje
        if (additionalText) {
            const additionalTextDiv = document.createElement('div');
            additionalTextDiv.textContent = additionalText;
            imageDiv.appendChild(additionalTextDiv);
        }

        // Dodaj div do body
        document.body.appendChild(imageDiv);
    }
}


// Wywołanie funkcji toggleImageOutside z odpowiednimi ścieżkami obrazków dla różnych kategorii
toggleImageOutside('SYSTEM PE-X', 'zdjecia/1/1_1/rura2.png', 'Opis obrazka dla SYSTEM PE-X', 'Dodatkowy tekst dla SYSTEM PE-X');
toggleImageOutside('Inna Kategoria', 'zdjecia/inna-kategoria.png', 'Opis obrazka dla Inna Kategoria', 'Dodatkowy tekst dla Inna Kategoria');

// Wywołanie funkcji toggleImageOutside z odpowiednimi ścieżkami obrazków dla różnych kategorii
toggleImageOutside('SYSTEM PE-X', 'zdjecia/1/1_1/rura2.png', 'Opis obrazka dla SYSTEM PE-X');
toggleImageOutside('Inna Kategoria', 'zdjecia/inna-kategoria.png', 'Opis obrazka dla Inna Kategoria');


// Zmienna globalna do śledzenia aktualnie wyświetlanej kategorii
let currentCategory = null;
let intervalId = null; // Zmienna globalna do przechowywania intervalId

function toggleImages(category) {
    console.log("Kategoria kliknięta:", category);

    // Znajdź lub utwórz główny kontener dla wszystkich zdjęć
    let mainImageContainer = document.querySelector('.main-image-container');

    // Jeśli kliknięta kategoria jest już wyświetlana, usuń kontener, zatrzymaj interwał i zresetuj currentCategory
    if (currentCategory === category) {
        if (mainImageContainer) {
            mainImageContainer.remove();
        }
        if (intervalId) {
            clearInterval(intervalId); // Zatrzymaj interwał
            intervalId = null; // Zresetuj intervalId
        }
        currentCategory = null;
        return;
    }

    // Ustaw nową kategorię jako aktualnie wyświetlaną
    currentCategory = category;

    if (!mainImageContainer) {
        mainImageContainer = document.createElement('div');
        mainImageContainer.classList.add('main-image-container');
        document.body.appendChild(mainImageContainer);
    } else {
        // Usuń istniejące obrazki z głównego kontenera
        mainImageContainer.innerHTML = '';
    }

    // Pobierz dane obrazków dla danej kategorii
    const images = imagesData[category];
    if (images) {
        // Ustaw licznik obecnego obrazka na 0
        let currentIndex = 0;

        // Funkcja do wyświetlania następnego obrazka
        const showNextImage = () => {
            // Usuń poprzedni obrazek i opis
            mainImageContainer.innerHTML = '';

            // Pobierz kolejny obrazek z tablicy
            const image = images[currentIndex];

            // Utwórz element <img> dla obrazka
            const img = document.createElement('img');
            img.src = image.imagePath;
            img.alt = image.altText;

            // Utwórz element <div> dla opisu obrazka
            const descriptionDiv = document.createElement('div');
            descriptionDiv.textContent = image.additionalText;
            descriptionDiv.classList.add('description');

            // Dodaj obrazek i opis do głównego kontenera
            mainImageContainer.appendChild(img);
            mainImageContainer.appendChild(descriptionDiv);

            // Dodaj klasę 'visible' do opisu po krótkim opóźnieniu, aby uruchomić animację
            setTimeout(() => {
                descriptionDiv.classList.add('visible');
            }, 10);

            // Inkrementuj licznik lub wróć do 0, jeśli osiągnięto koniec tablicy obrazków
            currentIndex = (currentIndex + 1) % images.length;
        };

        // Wywołaj funkcję showNextImage co 5 sekund i zapisz intervalId
        intervalId = setInterval(showNextImage, 5000);

        // Wywołaj funkcję showNextImage, aby wyświetlić pierwszy obrazek od razu
        showNextImage();
    } else {
        console.error('Brak obrazków dla kategorii:', category);
    }
}

// Funkcja do dodawania obrazka do kategorii
function addCategoryImage(activeCategory) {
    // Sprawdź, czy aktywna kategoria istnieje i czy obrazek nie został już dodany
    if (activeCategory && !activeCategory.querySelector('.category-image')) {
        const img = document.createElement('img');
        img.src = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj0ZXh0PjwvZz48L3N2Zz4='; // Twój kod base64
        img.alt = 'Opis obrazka';
        img.classList.add('category-specific-image'); // Nowa unikalna klasa

        // Dodaj obrazek wewnątrz aktywnej kategorii
        activeCategory.appendChild(img);

        // Dodaj zdarzenie kliknięcia do obrazka, aby ukryć go i zatrzymać animację obrazków
        img.addEventListener('click', () => {
            img.remove(); // Usuń obrazek
            toggleImages(currentCategory); // Zatrzymaj animację obrazków i usuń kontener
        });
    }
}

// Tutaj dodaj dane obrazków dla kategorii
const imagesData = {
    'SYSTEM PE-X': [
        { imagePath: 'zdjecia/1/1_1/rura2.png', altText: 'NO NIE WIEM 1', additionalText: 'Dodatkowy tekst 1 dla SYSTEM PE-X' },
        { imagePath: 'zdjecia/1/1_1/rura2.png', altText: 'SIE OKAZE 2', additionalText: 'Dodatkowy tekst 2 dla SYSTEM PE-X' },
        { imagePath: 'zdjecia/1/1_1/rura2.png', altText: 'Opis obrazka 3 dla SYSTEM PE-X', additionalText: 'Dodatkowy tekst 3 dla SYSTEM PE-X' },
        { imagePath: 'zdjecia/1/1_1/rura2.png', altText: 'Opis obrazka 4 dla SYSTEM PE-X', additionalText: 'Dodatkowy tekst 4 dla SYSTEM PE-X' },
        { imagePath: 'zdjecia/1/1_1/rura2.png', altText: 'Opis obrazka 5 dla SYSTEM PE-X', additionalText: 'Dodatkowy tekst 5 dla SYSTEM PE-X' },
        { imagePath: 'zdjecia/1/1_1/rura2.png', altText: 'Opis obrazka 6 dla SYSTEM PE-X', additionalText: 'Dodatkowy tekst 6 dla SYSTEM PE-X' }
    ],
    'Inna Kategoria': [
        { imagePath: 'zdjecia/inna-kategoria1.png', altText: 'Opis obrazka 1 dla Inna Kategoria', additionalText: 'Dodatkowy tekst 1 dla Inna Kategoria' },
        { imagePath: 'zdjecia/inna-kategoria2.png', altText: 'Opis obrazka 2 dla Inna Kategoria', additionalText: 'Dodatkowy tekst 2 dla Inna Kategoria' },
        { imagePath: 'zdjecia/inna-kategoria3.png', altText: 'Opis obrazka 3 dla Inna Kategoria', additionalText: 'Dodatkowy tekst 3 dla Inna Kategoria' },
        { imagePath: 'zdjecia/inna-kategoria4.png', altText: 'Opis obrazka 4 dla Inna Kategoria', additionalText: 'Dodatkowy tekst 4 dla Inna Kategoria' },
        { imagePath: 'zdjecia/inna-kategoria5.png', altText: 'Opis obrazka 5 dla Inna Kategoria', additionalText: 'Dodatkowy tekst 5 dla Inna Kategoria' },
        { imagePath: 'zdjecia/inna-kategoria6.png', altText: 'Opis obrazka 6 dla Inna Kategoria', additionalText: 'Dodatkowy tekst 6 dla Inna Kategoria' }
    ]
};


    // Funkcja do pokazania paska ładowania
        function showLoadingBar() {
            const loadingBar = document.getElementById('loading-bar');
            loadingBar.style.width = '0%';
            document.getElementById('loading-bar-container').style.display = 'block';
            setTimeout(() => {
                loadingBar.style.width = '100%';
            }, 10);
        }

        // Funkcja do ukrycia paska ładowania
        function hideLoadingBar() {
            const loadingBar = document.getElementById('loading-bar');
            loadingBar.style.width = '100%';
            setTimeout(() => {
                document.getElementById('loading-bar-container').style.display = 'none';
                loadingBar.style.width = '0%';
            }, 300);
        }

        // W przypadku załadowania dokumentu
        document.addEventListener('DOMContentLoaded', (event) => {
            hideLoadingBar(); // Ukryj pasek ładowania po załadowaniu dokumentu
    
        });


 function toggleHighlight(element) {
    element.classList.toggle('highlight');
  }
